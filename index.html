<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SamdGame | –ò—Ç–æ–≥–∏ 2 –°–µ–∑–æ–Ω–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --dark-bg: #0a0e17;
            --dark-card: #111827;
            --primary-blue: #0066ff;
            --neon-blue: #00d4ff;
            --accent-blue: #3b82f6;
            --text-light: #f8fafc;
            --text-gray: #94a3b8;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .new-year-theme {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            position: relative;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(100vh); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .hidden {
            display: none !important;
        }

        .slide {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px 30px;
            margin: 20px 0;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 10px 40px rgba(0, 102, 255, 0.15);
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            background: linear-gradient(135deg, var(--primary-blue), var(--neon-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-align: center;
        }

        h1 { font-size: 2.8rem; margin-bottom: 10px; }
        h2 { font-size: 2.2rem; margin-bottom: 30px; }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
        }

        .stat-value {
            font-size: 3rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--neon-blue);
        }

        .stat-label {
            color: var(--text-gray);
            font-size: 1.1rem;
        }

        .coin-icon { color: var(--gold); font-size: 2.5rem; margin-bottom: 10px; }
        .ticket-icon { color: var(--silver); font-size: 2.5rem; margin-bottom: 10px; }
        .nft-icon { color: var(--bronze); font-size: 2.5rem; margin-bottom: 10px; }

        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .nft-item {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .nft-item:hover {
            border-color: var(--bronze);
            transform: scale(1.05);
        }

        .nft-image {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            margin-bottom: 15px;
            object-fit: cover;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .button {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: block;
            margin: 30px auto;
            min-width: 250px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 102, 255, 0.3);
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 102, 255, 0.4);
        }

        .button-secondary {
            background: transparent;
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
        }

        .countdown {
            text-align: center;
            margin: 40px 0;
        }

        .countdown-title {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #ff4757;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .countdown-unit {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            min-width: 100px;
        }

        .countdown-value {
            font-size: 3rem;
            font-weight: bold;
            color: #ff6b81;
        }

        .countdown-label {
            font-size: 1rem;
            color: var(--text-gray);
            margin-top: 10px;
        }

        .completion-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .completion-icon {
            font-size: 6rem;
            color: var(--neon-blue);
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .season-complete {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--neon-blue));
            border-radius: 4px;
            width: 0%;
            transition: width 1s ease-in-out;
        }

        .slide-counter {
            text-align: center;
            color: var(--text-gray);
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 100px 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(59, 130, 246, 0.3);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            color: #ef4444;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .rank-1 {
            background: linear-gradient(135deg, #ffd700, #ff9800);
            color: #000;
        }

        .rank-2 {
            background: linear-gradient(135deg, #c0c0c0, #a0a0a0);
            color: #000;
        }

        .rank-3 {
            background: linear-gradient(135deg, #cd7f32, #b56c28);
            color: #000;
        }

        .rank-other {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .calculating-stats {
            text-align: center;
            padding: 20px;
            color: var(--neon-blue);
        }

        .calculating-stats i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loadingScreen" class="loading">
            <div class="spinner"></div>
            <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</h2>
            <p id="loadingStatus">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firestore</p>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div id="calculatingScreen" class="slide hidden">
            <div class="calculating-stats">
                <i class="fas fa-calculator"></i>
                <h3>–†–∞—Å—á–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h3>
                <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤...</p>
                <div class="progress-bar">
                    <div id="calcProgress" class="progress" style="width: 0%"></div>
                </div>
                <p id="calcStatus">–ù–∞—á–∞–ª–æ —Ä–∞—Å—á–µ—Ç–∞</p>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
        <div id="errorScreen" class="slide hidden">
            <div class="completion-screen">
                <div class="completion-icon" style="color: #ef4444;">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h1 style="color: #ef4444;">–û—à–∏–±–∫–∞</h1>
                <p id="errorMessage" style="font-size: 1.2rem; margin: 20px 0 40px; color: var(--text-gray);">
                    –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </p>
                <button id="retryButton" class="button">
                    <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </button>
                <button id="useDemoButton" class="button" style="background: #10b981; margin-top: 10px;">
                    <i class="fas fa-play"></i> –î–µ–º–æ-—Ä–µ–∂–∏–º
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ–∑–æ–Ω–∞ -->
        <div id="seasonCompleteScreen" class="slide hidden">
            <div class="completion-screen">
                <div class="completion-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h1 class="season-complete">1 –°–ï–ó–û–ù –ó–ê–í–ï–†–®–ï–ù!</h1>
                <h2>–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –Ω–æ–≤—ã–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º!</h2>
                <button id="viewResultsBtn" class="button">
                    <i class="fas fa-chart-bar"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏
                </button>
            </div>
        </div>

        <!-- –°–ª–∞–π–¥—ã —Å –∏—Ç–æ–≥–∞–º–∏ -->
        <div id="resultsSlides" class="hidden">
            <!-- –°–ª–∞–π–¥ 1: –í–≤–µ–¥–µ–Ω–∏–µ -->
            <div id="slide1" class="slide">
                <h2>üéÆ –ò—Ç–æ–≥–∏ 1 –°–µ–∑–æ–Ω–∞ SamdGame</h2>
                <div style="text-align: center; margin: 30px 0;">
                    <i class="fas fa-gamepad" style="font-size: 4rem; color: var(--neon-blue); margin-bottom: 20px;"></i>
                    <p style="font-size: 1.2rem; line-height: 1.6; color: var(--text-gray);">
                        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é –≤–∞—à–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π!
                    </p>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 14%"></div>
                </div>
                <div class="slide-counter">1/7</div>
            </div>

            <!-- –°–ª–∞–π–¥ 2: –°–∞–º–¥–∫–æ–∏–Ω—ã -->
            <div id="slide2" class="slide hidden">
                <h2>üí∞ –í–∞—à–∏ –°–∞–º–¥–∫–æ–∏–Ω—ã</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="coin-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-value" id="userCoins">0</div>
                        <div class="stat-label">–í–∞—à–∏ –°–∞–º–¥–∫–æ–∏–Ω—ã</div>
                    </div>
                    <div class="stat-card">
                        <div class="coin-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="stat-value" id="globalCoins">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 28%"></div>
                </div>
                <div class="slide-counter">2/7</div>
            </div>

            <!-- –°–ª–∞–π–¥ 3: –¢–∏–∫–µ—Ç—ã -->
            <div id="slide3" class="slide hidden">
                <h2>üé´ –í–∞—à–∏ –¢–∏–∫–µ—Ç—ã</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="ticket-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-value" id="userTickets">0</div>
                        <div class="stat-label">–í–∞—à–∏ –¢–∏–∫–µ—Ç—ã</div>
                    </div>
                    <div class="stat-card">
                        <div class="ticket-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="stat-value" id="globalTickets">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 42%"></div>
                </div>
                <div class="slide-counter">3/7</div>
            </div>

            <!-- –°–ª–∞–π–¥ 4: NFT -->
            <div id="slide4" class="slide hidden">
                <h2>üèÜ –í–∞—à–∏ NFT –ö–æ–ª–ª–µ–∫—Ü–∏–∏</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="nft-icon">
                            <i class="fas fa-gem"></i>
                        </div>
                        <div class="stat-value" id="userNFTsCount">0</div>
                        <div class="stat-label">–í–∞—à–∏ NFT</div>
                    </div>
                    <div class="stat-card">
                        <div class="nft-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="stat-value" id="globalNFTsCount">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —É –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 57%"></div>
                </div>
                <div class="slide-counter">4/7</div>
            </div>

            <!-- –°–ª–∞–π–¥ 5: –î–µ—Ç–∞–ª–∏ NFT -->
            <div id="slide5" class="slide hidden">
                <h2>üé® –í–∞—à–∞ –ö–æ–ª–ª–µ–∫—Ü–∏—è NFT</h2>
                <div id="nftGrid" class="nft-grid">
                    <!-- NFT –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 71%"></div>
                </div>
                <div class="slide-counter">5/7</div>
            </div>

            <!-- –°–ª–∞–π–¥ 6: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="slide6" class="slide hidden">
                <h2>üìä –ì–ª–æ–±–∞–ª—å–Ω–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <i class="fas fa-users" style="font-size: 2.5rem; color: var(--neon-blue); margin-bottom: 15px;"></i>
                        <div class="stat-value" id="totalPlayers">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-chess-queen" style="font-size: 2.5rem; color: var(--gold); margin-bottom: 15px;"></i>
                        <div id="userRankContainer">
                            <div class="stat-value" id="userRank">#0</div>
                        </div>
                        <div class="stat-label">–í–∞—à–µ –º–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 85%"></div>
                </div>
                <div class="slide-counter">6/7</div>
            </div>

            <!-- –°–ª–∞–π–¥ 7: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ -->
            <div id="slide7" class="slide hidden">
                <div class="completion-screen">
                    <div class="completion-icon">
                        <i class="fas fa-award"></i>
                    </div>
                    <h1>–ò–¢–û–ì–ò –ü–û–î–í–ï–î–ï–ù–´!</h1>
                    <button id="nextSeasonBtn" class="button" style="margin-top: 40px;">
                        <i class="fas fa-rocket"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ 2 —Å–µ–∑–æ–Ω—É
                    </button>
                </div>
                <div class="progress-bar">
                    <div class="progress" style="width: 100%"></div>
                </div>
                <div class="slide-counter">7/7</div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                <button id="prevBtn" class="button button-secondary" style="display: none;">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                </button>
                <button id="nextBtn" class="button">
                    –î–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω 2 —Å–µ–∑–æ–Ω–∞ -->
        <div id="season2Screen" class="hidden">
            <div style="text-align: center; padding: 40px 20px;">
                <h1>–°–ï–ó–û–ù 2</h1>
                <h2 style="color: #ff6b81;">–°–∫–æ—Ä–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!</h2>
                
                <div class="countdown">
                    <div class="countdown-title">–î–æ –Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–ª–æ—Å—å:</div>
                    <div class="countdown-timer">
                        <div class="countdown-unit">
                            <div class="countdown-value" id="days">00</div>
                            <div class="countdown-label">–î–Ω–µ–π</div>
                        </div>
                        <div class="countdown-unit">
                            <div class="countdown-value" id="hours">00</div>
                            <div class="countdown-label">–ß–∞—Å–æ–≤</div>
                        </div>
                        <div class="countdown-unit">
                            <div class="countdown-value" id="minutes">00</div>
                            <div class="countdown-label">–ú–∏–Ω—É—Ç</div>
                        </div>
                        <div class="countdown-unit">
                            <div class="countdown-value" id="seconds">00</div>
                            <div class="countdown-label">–°–µ–∫—É–Ω–¥</div>
                        </div>
                    </div>
                </div>

                <button id="viewResultsAgainBtn" class="button" style="margin-top: 50px;">
                    <i class="fas fa-history"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–æ–≥–∏ –µ—â–µ —Ä–∞–∑
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCcxotG6DNpkUxTXplC4DURNe-S02otuc4",
            authDomain: "samdcoin-e65a5.firebaseapp.com",
            projectId: "samdcoin-e65a5",
            storageBucket: "samdcoin-e65a5.firebasestorage.app",
            messagingSenderId: "30873122562",
            appId: "1:30873122562:web:5243417cc6ebc5abe4341b",
            measurementId: "G-BBPFLK9DMS"
        };

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let db = null;
        let currentUser = null;
        let allUsers = []; // –ú–∞—Å—Å–∏–≤ –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        let userNFTs = [];
        let hasViewedResults = false;
        let currentSlide = 1;
        const totalSlides = 7;
        const season2StartDate = new Date('2025-12-19T17:00:00').getTime();

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–º–æ—Ç—Ä–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∏—Ç–æ–≥–∏
            hasViewedResults = localStorage.getItem('samdgame_results_viewed') === 'true';
            
            try {
                updateLoadingStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('Firestore –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadAllData();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
                if (!hasViewedResults) {
                    showSeasonCompleteScreen();
                } else {
                    showSeason2Screen();
                }
                
                document.getElementById('loadingScreen').classList.add('hidden');
                console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò ====================
        async function loadAllData() {
            try {
                // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const tg = window.Telegram?.WebApp;
                const telegramUser = tg?.initDataUnsafe?.user;
                
                if (!telegramUser) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram');
                }
                
                updateLoadingStatus('–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
                
                // 2. –ò—â–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                currentUser = await findCurrentUser(telegramUser);
                
                if (!currentUser) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
                }
                
                console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser);
                
                // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                showCalculatingScreen();
                updateCalcStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤...');
                
                // 4. –ó–∞–≥—Ä—É–∂–∞–µ–º –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                updateCalcProgress(10);
                allUsers = await loadAllUsers();
                updateCalcProgress(40);
                
                // 5. –ó–∞–≥—Ä—É–∂–∞–µ–º NFT —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                updateCalcStatus('–ó–∞–≥—Ä—É–∑–∫–∞ NFT...');
                userNFTs = await loadUserNFTs(currentUser.id);
                updateCalcProgress(70);
                
                // 6. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateCalcStatus('–†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...');
                const globalStats = calculateGlobalStats(allUsers);
                updateCalcProgress(90);
                
                // 7. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userRank = calculateUserRank(currentUser, allUsers);
                updateCalcProgress(100);
                
                // 8. –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateUIWithData(currentUser, globalStats, userNFTs, userRank);
                
                // 9. –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–∞—Å—á–µ—Ç–∞
                setTimeout(() => {
                    document.getElementById('calculatingScreen').classList.add('hidden');
                }, 500);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                throw error;
            }
        }

        // ==================== FIRESTORE –§–£–ù–ö–¶–ò–ò ====================
        async function findCurrentUser(telegramUser) {
            console.log('–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å telegramId:', telegramUser.id);
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞
            const searchQueries = [
                { field: 'telegramId', value: telegramUser.id.toString() },
                { field: 'telegram_id', value: telegramUser.id.toString() },
                { field: 'userId', value: telegramUser.id.toString() }
            ];
            
            if (telegramUser.username) {
                searchQueries.push({ field: 'username', value: telegramUser.username });
            }
            
            for (const query of searchQueries) {
                try {
                    const usersRef = db.collection('users');
                    const querySnapshot = await usersRef
                        .where(query.field, '==', query.value)
                        .limit(1)
                        .get();
                    
                    if (!querySnapshot.empty) {
                        const userDoc = querySnapshot.docs[0];
                        const userData = userDoc.data();
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º ID –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        return {
                            id: userDoc.id,
                            ...userData,
                            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–æ–ª—è
                            coins: parseInt(userData.coins || userData.samdcoins || 0),
                            tickets: parseInt(userData.tickets || 0)
                        };
                    }
                } catch (error) {
                    console.log(`–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—é ${query.field} –Ω–µ —É–¥–∞–ª—Å—è:`, error);
                }
            }
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            try {
                const usersRef = db.collection('users');
                const querySnapshot = await usersRef.limit(1).get();
                
                if (!querySnapshot.empty) {
                    const userDoc = querySnapshot.docs[0];
                    const userData = userDoc.data();
                    
                    return {
                        id: userDoc.id,
                        ...userData,
                        coins: parseInt(userData.coins || userData.samdcoins || 0),
                        tickets: parseInt(userData.tickets || 0)
                    };
                }
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
            
            return null;
        }

        async function loadAllUsers() {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
            
            try {
                const usersRef = db.collection('users');
                const querySnapshot = await usersRef.get();
                
                const users = [];
                
                querySnapshot.forEach(doc => {
                    const userData = doc.data();
                    
                    // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const normalizedUser = {
                        id: doc.id,
                        name: userData.name || userData.firstName || '–ò–≥—Ä–æ–∫',
                        coins: parseInt(userData.coins || userData.samdcoins || 0),
                        tickets: parseInt(userData.tickets || 0),
                        nftCount: calculateNFTCount(userData)
                    };
                    
                    users.push(normalizedUser);
                });
                
                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                return users;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                return [];
            }
        }

        function calculateNFTCount(userData) {
            // –ü–æ–¥—Å—á–µ—Ç NFT —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
            if (userData.nfts && Array.isArray(userData.nfts)) {
                return userData.nfts.length;
            }
            if (userData.nftCount) {
                return parseInt(userData.nftCount);
            }
            if (userData.nft && Array.isArray(userData.nft)) {
                return userData.nft.length;
            }
            return 0;
        }

        async function loadUserNFTs(userId) {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ NFT –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
            
            const nfts = [];
            
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ø–æ–¥–∫–æ–ª–ª–µ–∫—Ü–∏–∏
                const nftsRef = db.collection('users').doc(userId).collection('nfts');
                const nftsSnapshot = await nftsRef.get();
                
                if (!nftsSnapshot.empty) {
                    nftsSnapshot.forEach(doc => {
                        nfts.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${nfts.length} NFT –∏–∑ –ø–æ–¥–∫–æ–ª–ª–µ–∫—Ü–∏–∏`);
                    return nfts;
                }
            } catch (error) {
                console.log('–ü–æ–¥–∫–æ–ª–ª–µ–∫—Ü–∏—è nfts –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
            
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –º–∞—Å—Å–∏–≤–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (currentUser.nfts && Array.isArray(currentUser.nfts)) {
                return currentUser.nfts.map((nft, index) => ({
                    id: `nft-${index}`,
                    ...nft
                }));
            }
            
            console.log('NFT –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            return nfts;
        }

        // ==================== –†–ê–°–ß–ï–¢ –°–¢–ê–¢–ò–°–¢–ò–ö–ò ====================
        function calculateGlobalStats(users) {
            console.log('–†–∞—Å—á–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑', users.length, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
            
            if (users.length === 0) {
                return {
                    totalCoins: 0,
                    totalTickets: 0,
                    totalNFTs: 0,
                    totalPlayers: 0,
                    averageCoins: 0,
                    averageTickets: 0
                };
            }
            
            let totalCoins = 0;
            let totalTickets = 0;
            let totalNFTs = 0;
            
            users.forEach(user => {
                totalCoins += user.coins || 0;
                totalTickets += user.tickets || 0;
                totalNFTs += user.nftCount || 0;
            });
            
            return {
                totalCoins,
                totalTickets,
                totalNFTs,
                totalPlayers: users.length,
                averageCoins: Math.round(totalCoins / users.length),
                averageTickets: Math.round(totalTickets / users.length)
            };
        }

        function calculateUserRank(currentUser, allUsers) {
            if (!currentUser || allUsers.length === 0) return allUsers.length + 1;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –º–æ–Ω–µ—Ç (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            const sortedUsers = [...allUsers].sort((a, b) => (b.coins || 0) - (a.coins || 0));
            
            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userIndex = sortedUsers.findIndex(user => user.id === currentUser.id);
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Å—Ç–æ
            return userIndex !== -1 ? userIndex + 1 : sortedUsers.length + 1;
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
        function updateUIWithData(user, globalStats, nfts, userRank) {
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å –¥–∞–Ω–Ω—ã–º–∏');
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª
            function formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1).replace('.0', '') + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1).replace('.0', '') + 'K';
                return num.toString();
            }
            
            // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('userCoins').textContent = formatNumber(user.coins || 0);
            document.getElementById('userTickets').textContent = formatNumber(user.tickets || 0);
            document.getElementById('userNFTsCount').textContent = nfts.length;
            
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('globalCoins').textContent = formatNumber(globalStats.totalCoins || 0);
            document.getElementById('globalTickets').textContent = formatNumber(globalStats.totalTickets || 0);
            document.getElementById('globalNFTsCount').textContent = formatNumber(globalStats.totalNFTs || 0);
            document.getElementById('totalPlayers').textContent = formatNumber(globalStats.totalPlayers || 0);
            
            // –†–µ–π—Ç–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const rankElement = document.getElementById('userRank');
            rankElement.textContent = '#' + userRank;
            
            // –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
            let rankClass = 'rank-other';
            if (userRank === 1) rankClass = 'rank-1';
            else if (userRank === 2) rankClass = 'rank-2';
            else if (userRank === 3) rankClass = 'rank-3';
            
            document.getElementById('userRankContainer').innerHTML = `
                <div class="rank-badge ${rankClass}">${userRank}</div>
            `;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º NFT
            displayNFTs(nfts);
        }

        function displayNFTs(nfts) {
            const nftGrid = document.getElementById('nftGrid');
            nftGrid.innerHTML = '';
            
            if (nfts.length === 0) {
                nftGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-gray);">
                        <i class="fas fa-gem" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <p>NFT –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }
            
            nfts.forEach((nft, index) => {
                const nftItem = document.createElement('div');
                nftItem.className = 'nft-item';
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                const imageUrl = nft.imageUrl || nft.image || 
                    `https://api.dicebear.com/7.x/shapes/svg?seed=samd${index}&size=100&backgroundColor=${getRandomColor()}`;
                
                nftItem.innerHTML = `
                    <img class="nft-image" 
                         src="${imageUrl}" 
                         alt="${nft.name || 'NFT ' + (index + 1)}"
                         onerror="this.src='https://api.dicebear.com/7.x/shapes/svg?seed=fallback${index}&size=100'">
                    <div style="font-weight: bold; color: white; margin-bottom: 5px;">
                        ${nft.name || 'NFT ' + (index + 1)}
                    </div>
                    ${nft.rarity ? `<div style="font-size: 0.9rem; color: #f59e0b;">${nft.rarity}</div>` : ''}
                `;
                
                nftGrid.appendChild(nftItem);
            });
        }

        function getRandomColor() {
            const colors = ['3498db', '9b59b6', '2ecc71', 'e74c3c', 'f39c12'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function updateLoadingStatus(message) {
            const statusElement = document.getElementById('loadingStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        function updateCalcStatus(message) {
            const statusElement = document.getElementById('calcStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        function updateCalcProgress(percent) {
            const progressElement = document.getElementById('calcProgress');
            if (progressElement) {
                progressElement.style.width = percent + '%';
            }
        }

        function updateCountdown() {
            const now = new Date().getTime();
            const timeLeft = season2StartDate - now;
            
            if (timeLeft > 0) {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            } else {
                const countdownElement = document.querySelector('.countdown');
                if (countdownElement) {
                    countdownElement.innerHTML = '<h2 style="color: #2ecc71;">–°–µ–∑–æ–Ω –Ω–∞—á–∞–ª—Å—è!</h2>';
                }
            }
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ====================
        function showCalculatingScreen() {
            hideAllScreens();
            document.getElementById('calculatingScreen').classList.remove('hidden');
        }

        function showError(message) {
            hideAllScreens();
            document.getElementById('errorScreen').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function showSeasonCompleteScreen() {
            hideAllScreens();
            document.getElementById('seasonCompleteScreen').classList.remove('hidden');
        }

        function showResultsSlides() {
            hideAllScreens();
            document.getElementById('resultsSlides').classList.remove('hidden');
            showSlide(1);
        }

        function showSeason2Screen() {
            hideAllScreens();
            document.getElementById('season2Screen').classList.remove('hidden');
        }

        function hideAllScreens() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('calculatingScreen').classList.add('hidden');
            document.getElementById('errorScreen').classList.add('hidden');
            document.getElementById('seasonCompleteScreen').classList.add('hidden');
            document.getElementById('resultsSlides').classList.add('hidden');
            document.getElementById('season2Screen').classList.add('hidden');
        }

        function showSlide(slideNumber) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã
            for (let i = 1; i <= totalSlides; i++) {
                const slide = document.getElementById(`slide${i}`);
                if (slide) slide.classList.add('hidden');
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π —Å–ª–∞–π–¥
            const currentSlideElement = document.getElementById(`slide${slideNumber}`);
            if (currentSlideElement) {
                currentSlideElement.classList.remove('hidden');
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.getElementById('prevBtn').style.display = slideNumber === 1 ? 'none' : 'flex';
            document.getElementById('nextBtn').style.display = slideNumber === totalSlides ? 'none' : 'flex';
            
            currentSlide = slideNumber;
        }

        function nextSlide() {
            if (currentSlide < totalSlides) {
                showSlide(currentSlide + 1);
            } else {
                hasViewedResults = true;
                localStorage.setItem('samdgame_results_viewed', 'true');
                showSeason2Screen();
            }
        }

        function prevSlide() {
            if (currentSlide > 1) {
                showSlide(currentSlide - 1);
            }
        }

        // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================
        document.getElementById('viewResultsBtn').addEventListener('click', showResultsSlides);
        document.getElementById('viewResultsAgainBtn').addEventListener('click', showResultsSlides);
        document.getElementById('nextSeasonBtn').addEventListener('click', () => {
            hasViewedResults = true;
            localStorage.setItem('samdgame_results_viewed', 'true');
            showSeason2Screen();
        });
        document.getElementById('nextBtn').addEventListener('click', nextSlide);
        document.getElementById('prevBtn').addEventListener('click', prevSlide);
        document.getElementById('retryButton').addEventListener('click', () => location.reload());
        document.getElementById('useDemoButton').addEventListener('click', () => {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
            currentUser = {
                id: 'demo',
                name: '–î–µ–º–æ –ò–≥—Ä–æ–∫',
                coins: 1847,
                tickets: 23
            };
            
            allUsers = Array.from({length: 100}, (_, i) => ({
                id: `user-${i}`,
                name: `–ò–≥—Ä–æ–∫ ${i + 1}`,
                coins: Math.floor(Math.random() * 5000),
                tickets: Math.floor(Math.random() * 100),
                nftCount: Math.floor(Math.random() * 10)
            }));
            
            userNFTs = [
                { name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è NFT', rarity: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è' },
                { name: '–≠–ø–∏—á–µ—Å–∫–∞—è NFT', rarity: '–≠–ø–∏—á–µ—Å–∫–∞—è' },
                { name: '–†–µ–¥–∫–∞—è NFT', rarity: '–†–µ–¥–∫–∞—è' }
            ];
            
            const globalStats = calculateGlobalStats(allUsers);
            const userRank = calculateUserRank(currentUser, allUsers);
            
            updateUIWithData(currentUser, globalStats, userNFTs, userRank);
            document.getElementById('errorScreen').classList.add('hidden');
            showSeasonCompleteScreen();
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–ª–∞–≤–∏—à–∞–º–∏
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextSlide();
            if (e.key === 'ArrowLeft') prevSlide();
        });
    </script>
</body>
</html>